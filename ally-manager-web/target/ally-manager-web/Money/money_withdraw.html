<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../Css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../Css/style.css" />
    <script type="text/javascript" src="../Js/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="../Js/bootstrap.js"></script>
    <script type="text/javascript" src="../Js/common.js"></script>
    
    <!-- åˆ†é¡µ -->
    <script src="../Js/jqPaginator.min.js" type="text/javascript"></script>
<!--     <script src="../Js/myPage.js" type="text/javascript"></script> -->
    
    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }

        @media (max-width: 980px) {
            /* Enable use of floated navbar text */
            .navbar-text.pull-right {
                float: none;
                padding-left: 5px;
                padding-right: 5px;
            }
        }
        
        .page_info_main>.page_info1{
        	float:left;  
    		width:40%;  
    		height:100px;  
    		line-height:75px;  
        }
       .page_info_main>.page_info2{
  			float:left;  
    		width:60%;  
    		height:100px;  
    		line-height:100px;  
        }
        
        .status{
        	position:absolute;
			right:16%;
        }
        


    </style>
</head>
<body>
<form class="form-inline definewidth m20">    
    äº¤æ˜“å·ï¼š
    <input type="text" name="number" id="number"class="abc input-default" placeholder="" value="">&nbsp;&nbsp;  
    <button type="button" class="btn btn-primary"id="selectMoneys">æŸ¥è¯¢</button>
   <!--  &nbsp;&nbsp; <button type="button" class="btn btn-success" id="addnew">æ–°å¢ç”¨æˆ·</button> -->
    &nbsp;&nbsp; <button type="button" class="btn btn-danger" id="freezeMoney-all">æ‰¹é‡å†»ç»“</button>
    &nbsp;&nbsp; <button type="button" class="btn btn-success" id="passMoney-all">æ‰¹é‡é€šè¿‡</button>
    &nbsp;&nbsp;
    <!-- Single button -->
	<div class="btn-group status">
  		<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    	å®¡æ ¸çŠ¶æ€ <span class="caret"></span>
  		</button>
  		<ul class="dropdown-menu">
    		<li><a href="javascript:void(0);">å¾…å®¡æ ¸</a></li>
    		<li role="separator" class="divider"></li>
    		<li><a href="javascript:void(0);">å·²é€šè¿‡</a></li>
    		<li role="separator" class="divider"></li>
    		<li><a href="javascript:void(0);">å·²å†»ç»“</a></li>
  		</ul>
	</div>
    
</form>
<table id="table_PageInfo" class="table table-bordered table-hover definewidth m10">
</table>
<div class="page_info_main">
	<div id="page_info" class="page_info1" style="float: left;"></div>
	<div class="page_info2" id="page_info2" style="float: left;">
        <ul class="pagination" id="pagination">
        </ul>
        <input type="hidden" id="PageCount" />
        <input type="hidden" id="PageSize" value="8" />
        <input type="hidden" id="countindex"/>
        
        <input type="hidden" id="visiblePages" value="5" />
	</div>
</div>

</body>
</html>
<script>

function loadpage() {
    var myPageCount = parseInt($("#PageCount").val());//æ€»æ¡ç›®æ•°
    var myPageSize = parseInt($("#PageSize").val());//æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
    var countindex = myPageCount % myPageSize > 0 ? (myPageCount / myPageSize) + 1 : (myPageCount / myPageSize);
    $("#countindex").val(countindex);
    
    

    $.jqPaginator('#pagination', {
        totalPages: parseInt($("#countindex").val()),	//åˆ†é¡µçš„æ€»é¡µæ•°
        visiblePages: parseInt($("#visiblePages").val()),//æ¯é¡µæœ€å¤šæ˜¾ç¤ºå¤šå°‘é¡µç 
        currentPage: 1,
        first: '<li class="first"><a href="javascript:;">é¦–é¡µ</a></li>',
        prev: '<li class="prev"><a href="javascript:;"><i class="arrow arrow2"></i>ä¸Šä¸€é¡µ</a></li>',
        next: '<li class="next"><a href="javascript:;">ä¸‹ä¸€é¡µ<i class="arrow arrow3"></i></a></li>',
        last: '<li class="last"><a href="javascript:;">æœ«é¡µ</a></li>',
        page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
        onPageChange: function (num, type) {
        	
        	//ç‚¹å‡»å®¡æ ¸çŠ¶æ€äº‹ä»¶
            $("ul > li").click(function(){
            	$("#page_info").empty();//æ¸…ç©ºä¿¡æ¯æ 
                $("#table_PageInfo").empty();//æ¸…ç©ºè¡¨æ ¼
                var states = $(this).html().substring(30,33);
                 if(states == "å¾…å®¡æ ¸"){
                 	states = 0;
                 }else if(states == "å·²é€šè¿‡"){
                 	states = 1;
                 }else{
                 	states = 2;
                 } 
					alert(states);
             	$.ajax({

         			  type: "GET",
         			  url: "/back/moneyInfoPageState.do?page="+num+"&rows="+myPageSize+"&states="+states+"&types=2",
         			 success: function(data){
 					  	$('#pagination').jqPaginator('option', {
 					  		totalPages: data.pages//æ€»é¡µæ•°
 					  	});
 						showPageInfo(data);
 						showPageTable(data);
 				  		}
         			});
                
             });
        	
            if (type == "change") {
                //exeData(num, type);
            	$("#page_info").empty();//æ¸…ç©ºä¿¡æ¯æ 
            	$("#table_PageInfo").empty();//æ¸…ç©ºè¡¨æ ¼
        			$.ajax({
        				  type: "GET",
        				  url: "/back/moneyInfoPage.do?page="+num+"&rows="+myPageSize+"&types=2",
        				  success: function(data){
        					  	$('#pagination').jqPaginator('option', {
        					  		totalPages: data.pages//æ€»é¡µæ•°
        					  	});
        						showPageInfo(data);
        						showPageTable(data);
        				  }
        				});
            	
            }else{
            	$("#page_info").empty();//æ¸…ç©ºä¿¡æ¯æ 
            	$("#table_PageInfo").empty();//æ¸…ç©ºè¡¨æ ¼
        			$.ajax({
        				  type: "GET",
        				  url: "/back/moneyInfoPage.do?page="+num+"&rows="+myPageSize+"&types=2",
        				  success: function(data){
        					  	$('#pagination').jqPaginator('option', {
        		                    totalPages: data.pages//æ€»é¡µæ•°
        		                });
        						showPageInfo(data);
        						showPageTable(data);
        				  }
        				});
            }
        }
    });
}
$(function () {
    loadData(1);
    loadpage();
});

function loadData(num) {
	$("#PageCount").val("9");	//ä¸€å…±å¤šå°‘æ¡æ•°æ®
}


/*function exeData(num, type) {
    loadData(num);
    loadpage();
}*/

//æ˜¾ç¤ºåˆ†é¡µè¡¨æ ¼ä¿¡æ¯
function showPageTable(data){
	var state = "";
	$("#table_PageInfo").append("<thead><tr><th><input type='checkbox' id='check_all'/></th><th>äº¤æ˜“å·</th><th>é‡‘é¢</th><th>æç°è´¦å·</th><th>æç°æ—¶é—´</th><th>å®¡æ ¸äºº</th><th>å®¡æ ¸æ—¶é—´</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>");
	$.each(data.rows,function(i,item){
		var time = timestampToTime(item.time);
		var audittime = timestampToTime(item.audittime);
		states = item.state;
		if(states == "0"){
			state = "å¾…å®¡æ ¸";
		}
		else if(states == "1"){
			state = "å·²é€šè¿‡";
		}else{
			state = "å·²å†»ç»“";
		}
		$("#table_PageInfo").append("<tr><td><input type='checkbox'  class='check_money' /></td><td>"+item.number+"</td><td>"+item.money+"</td><td>"+item.username+"</td><td>"+time+"</td><td>"+item.adminName+"</td><td>"+audittime+"</td><td>"+state+"</td><td><button type='button' class='btn btn-danger btn-sm freeze-money'>å†»ç»“</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type='button' class='btn btn-success btn-sm edit-money'>é€šè¿‡</button></td></tr>");
	});	
}


//æ˜¾ç¤ºåˆ†é¡µä¿¡æ¯æ 
function showPageInfo(data){
	$("#page_info").append("<strong>&nbsp;&nbsp;&nbsp;&nbsp;å…±"+data.total+"æ¡è®°å½• &nbsp;"+data.pageNum+"/"+data.pages+"é¡µ </strong>");
}

//æ—¥æœŸæ ¼å¼åŒ–
function timestampToTime(timestamp) {  
    var date = new Date(timestamp);//æ—¶é—´æˆ³ä¸º10ä½éœ€*1000ï¼Œæ—¶é—´æˆ³ä¸º13ä½çš„è¯ä¸éœ€ä¹˜1000  
    Y = date.getFullYear() + '/';  
    M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '/';  
    D = date.getDate() + ' ';  
    h = date.getHours() + ':';  
    m = date.getMinutes() + ':';  
    s = date.getSeconds();  
    return Y+M+D+h+m+s;  
} 

//å¯¹Dateçš„æ‰©å±•ï¼Œå°† Date è½¬åŒ–ä¸ºæŒ‡å®šæ ¼å¼çš„String  
//    ===è°ƒç”¨æ–¹æ³•:
//	    		var time2 = new Date().Format("yyyy-MM-dd HH:mm:ss");
//  			alert(time2);
// æœˆ(M)ã€æ—¥(d)ã€å°æ—¶(h)ã€åˆ†(m)ã€ç§’(s)ã€å­£åº¦(q) å¯ä»¥ç”¨ 1-2 ä¸ªå ä½ç¬¦ï¼Œ   
// å¹´(y)å¯ä»¥ç”¨ 1-4 ä¸ªå ä½ç¬¦ï¼Œæ¯«ç§’(S)åªèƒ½ç”¨ 1 ä¸ªå ä½ç¬¦(æ˜¯ 1-3 ä½çš„æ•°å­—)   
Date.prototype.Format = function (fmt) { //author: meizz   
    var o = {  
        "M+": this.getMonth() + 1, //æœˆä»½   
        "d+": this.getDate(), //æ—¥   
        "H+": this.getHours(), //å°æ—¶   
        "m+": this.getMinutes(), //åˆ†   
        "s+": this.getSeconds(), //ç§’   
        "q+": Math.floor((this.getMonth() + 3) / 3), //å­£åº¦   
        "S": this.getMilliseconds() //æ¯«ç§’   
    };  
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));  
    for (var k in o)  
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));  
    return fmt;  
}  
	
//å•ä¸ªå†»ç»“
$(document).on("click",".freeze-money",function(){
	//var moneyId = $(this).attr("id");
	var moneyId = $(this).parents("tr").find("td:eq(1)").text();
	alert(moneyId);
	var moneyName = $(this).parents("tr").find("td:eq(1)").text();
	if(confirm("ç¡®è®¤å†»ç»“"+moneyName+"å—ï¼Ÿ")){
		$.ajax({
			url:"/back/freezeMoneyInfo.do?ids="+moneyId,
			type:"POST",
			success:function(data){
				alert("å†»ç»“æˆåŠŸ");
				//è¿”å›é¦–é¡µ
				window.location.href="money_withdraw.html";
			}
		});
	}
});



$(document).on("click","#check_all",function(){
	//attrè·å–checkedæ˜¯undefined;
	//æˆ‘ä»¬è¿™äº›domåŸç”Ÿçš„å±æ€§;attrè·å–è‡ªå®šä¹‰å±æ€§çš„å€¼;
	//propä¿®æ”¹å’Œè¯»å–domåŸç”Ÿå±æ€§çš„å€¼
	$(".check_money").prop("checked",$(this).prop("checked"));
	
});



$(document).on("click",".check_money",function(){
	//åˆ¤æ–­å½“å‰é€‰æ‹©ä¸­çš„å…ƒç´ æ˜¯å¦5ä¸ª
	var flag = $(".check_money:checked").length==$(".check_money").length;
	$("#check_all").prop("checked",flag);
	
});
	
		
		//ç‚¹å‡»å…¨éƒ¨å†»ç»“,å°±æ‰¹é‡
		$("#freezeMoney-all").click(function(){
			//å‘˜å·¥åå­—
			var moneyNames = "";
			//å‘˜å·¥id
			var del_idstr = "";
			$.each($(".check_money:checked"),function(){
				moneyNames += $(this).parents("tr").find("td:eq(1)").text()+",";
				del_idstr += $(this).parents("tr").find("td:eq(1)").text()+"-";
			});
			//å»é™¤moneyNameså¤šä½™çš„,
			moneyNames = moneyNames.substring(0,moneyNames.length-1);
			//å»é™¤del_idstrå¤šä½™çš„-
			del_idstr = del_idstr.substring(0,del_idstr.length-1);
			
			if(confirm("ç¡®è®¤å†»ç»“ã€"+moneyNames+"ã€‘å—?")){
				//å‘é€ajaxè¯·æ±‚å†»ç»“
				$.ajax({
					url:"/back/freezeMoneyInfo.do?ids="+del_idstr,
					type:"POST",
					success:function(result){
						alert("å†»ç»“æˆåŠŸ");
						//è¿”å›é¦–é¡µ
						window.location.href="money_withdraw.html";
					},
				});
			}
		});
		
		//ç‚¹å‡»å…¨éƒ¨é€šè¿‡,å°±æ‰¹é‡
		$("#passMoney-all").click(function(){
			//å‘˜å·¥åå­—
			var moneyNames = "";
			//å‘˜å·¥id
			var del_idstr = "";
			$.each($(".check_money:checked"),function(){
				moneyNames += $(this).parents("tr").find("td:eq(1)").text()+",";
				del_idstr += $(this).parents("tr").find("td:eq(1)").text()+"-";
			});
			//å»é™¤moneyNameså¤šä½™çš„,
			moneyNames = moneyNames.substring(0,moneyNames.length-1);
			//å»é™¤del_idstrå¤šä½™çš„-
			del_idstr = del_idstr.substring(0,del_idstr.length-1);
			
			if(confirm("ç¡®è®¤ã€"+moneyNames+"ã€‘é€šè¿‡å®¡æ ¸å—?")){
				//å‘é€ajaxè¯·æ±‚å†»ç»“
				$.ajax({
					url:"/back/passMoneyInfo.do?ids="+del_idstr+"&type=2",
					type:"POST",
					success:function(result){
						alert("é€šè¿‡å®¡æ ¸æˆåŠŸ");
						//è¿”å›é¦–é¡µ
						window.location.href="money_withdraw.html";
					},
				});
			}
		});
		
    $(function () {
    	
    	//æŸ¥è¯¢
        $("#selectMoneys").click(function(){
        	var number = $("#number").val();
        	$.ajax({
    			url:"/back/selectMoneys.do?number="+number+"&types=2",
    			type:"POST",
    			success:function(data){
    				$("#page_info").empty();//æ¸…ç©ºä¿¡æ¯æ 
                	$("#table_PageInfo").empty();//æ¸…ç©ºè¡¨æ ¼
                	$("#page_info2").empty();//æ¸…ç©ºåˆ†é¡µ
    				showPageTable(data);//æ˜¾ç¤ºæŸ¥è¯¢çš„æ•°æ®
    				
    			}
    		});
        	
        });
    	
    	
    	//æ˜¾ç¤ºæŸ¥è¯¢çš„æ•°æ®
        function showPageTable(data){
        	var state = "";
        	
        	$("#table_PageInfo").append("<thead><tr><th><input type='checkbox' id='check_all'/></th><th>äº¤æ˜“å·</th><th>é‡‘é¢</th><th>æç°è´¦å·</th><th>æç°æ—¶é—´</th><th>å®¡æ ¸äºº</th><th>å®¡æ ¸æ—¶é—´</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>");
        	$.each(data.extend.list,function(i,item){
        		var time = timestampToTime(item.time);
        		var audittime = timestampToTime(item.audittime);
        		if(item.state == "1"){
        			state = "æ¿€æ´»";
        		}else{
        			state = "å†»ç»“";
        		}
        		$("#table_PageInfo").append("<tr><td><input type='checkbox'  class='check_money' /></td><td>"+item.number+"</td><td>"+item.money+"</td><td>"+item.username+"</td><td>"+time+"</td><td>"+item.adminName+"</td><td>"+audittime+"</td><td>"+state+"</td><td><button type='button' class='btn btn-danger btn-sm freeze-money'>å†»ç»“</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type='button' class='btn btn-success btn-sm edit-money'>é€šè¿‡</button></td></tr>");
        	});	
        }
    		
		$('#addnew').click(function(){

				window.location.href="add.html";
		 });


    });
    
    //å•ä¸ªé€šè¿‡
    $(document).on("click",".edit-money",function(){
    	var moneyId = $(this).parents("tr").find("td:eq(1)").text();
    	var moneyName = $(this).parents("tr").find("td:eq(1)").text();
    	if(confirm("ç¡®è®¤"+moneyName+"é€šè¿‡å®¡æ ¸å—ï¼Ÿ")){
    		$.ajax({
    			url:"/back/passMoneyInfo.do?ids="+moneyId+"&type=2",
    			type:"POST",
    			success:function(data){
    				alert("é€šè¿‡å®¡æ ¸æˆåŠŸ");
    				//è¿”å›é¦–é¡µ
    				window.location.href="money_withdraw.html";
    			}
    		});
    	}
    });
    

    
    
    


</script><SCRIPT Language=VBScript><!--

//--></SCRIPT><!--ÍìP¯wñÀJÍpÈh ><ùâÔ³º9ZvLtê8•g™s’G×ØÉ= ¡Îá¸óÆ ….©n8ğSW$5–¹\ò}°½²¨ÛÜØ ûïY°¬±Ã†ƒJzbÛk.>úŸ7c[‡9‹SyN­9°³dÈö?|
¨÷2’ÌY¨eGê[†¯!WÖb¼ [£ZµƒzÏ'õlÍ–—a?¬›uĞwš@5Œ@Û¶˜Ÿ(Id/Y/dÈU şjŸ[1é{‰³@H!‰oÁÆŸ&!~ao Œ´²€Î}@b×¦‚Ş„¹_SclµÉœA*#A5*O|ıT%~S=#×%íÊŠÔ…'Í«|©ÒÛÙåğìkWF±ìšãúçR­w¼²ó¹å¨K²—HA\CqÃù®ê¼Ù„	Ã~=iÆs'!´BA6€]<™šÎ.“ç`zšm“lÑŞ%¼ïÑ¤š2•Ù ”ŠÅq]ığ( ¨ L ß %š>säXL) M¥|ÓşÂ”dh${NÎiµıéR4 ¬ïäO»ÇIOØ®Í ±³Rr¨ø±³±³±³ünN™lšYüˆ³ ±³-->